(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}(e.L||(e.L={})).Schematic=t()}})(function(){var t,e,i;return function n(t,e,i){function r(s,a){if(!e[s]){if(!t[s]){var h=typeof require=="function"&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=e[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return r(i?i:e)},u,u.exports,n,t,e,i)}return e[s].exports}var o=typeof require=="function"&&require;for(var s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,i){"use strict";e.exports=t("./src/schematic")},{"./src/schematic":5}],2:[function(t,e,i){(function(){var t=typeof i!="undefined"?i:self;var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function n(t){this.message=t}n.prototype=new Error;n.prototype.name="InvalidCharacterError";t.btoa||(t.btoa=function(t){var i=String(t);for(var r,o,s=0,a=e,h="";i.charAt(s|0)||(a="=",s%1);h+=a.charAt(63&r>>8-s%1*8)){o=i.charCodeAt(s+=3/4);if(o>255){throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.")}r=r<<8|o}return h});t.atob||(t.atob=function(t){var i=String(t).replace(/=+$/,"");if(i.length%4==1){throw new n("'atob' failed: The string to be decoded is not correctly encoded.")}for(var r=0,o,s,a=0,h="";s=i.charAt(a++);~s&&(o=r%4?o*64+s:s,r++%4)?h+=String.fromCharCode(255&o>>(-2*r&6)):0){s=e.indexOf(s)}return h})})()},{}],3:[function(t,e,i){(function(t){"use strict";var e=typeof window!=="undefined"?window["L"]:typeof t!=="undefined"?t["L"]:null;e.Bounds.prototype.toBBox=function(){return[this.min.x,this.min.y,this.max.x,this.max.y]};e.Bounds.prototype.scale=function(t){var i=this.max;var n=this.min;var r=(i.x-n.x)/2*(t-1);var o=(i.y-n.y)/2*(t-1);return new e.Bounds([[n.x-r,n.y-o],[i.x+r,i.y+o]])};e.LatLngBounds.prototype.toBBox=function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()]};e.LatLngBounds.prototype.scale=function(t){var i=this._northEast;var n=this._southWest;var r=(i.lng-n.lng)/2*(t-1);var o=(i.lat-n.lat)/2*(t-1);return new e.LatLngBounds([[n.lat-o,n.lng-r],[i.lat+o,i.lng+r]])}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],4:[function(t,e,i){(function(t){"use strict";var i=typeof window!=="undefined"?window["L"]:typeof t!=="undefined"?t["L"]:null;i.SchematicRenderer=e.exports=i.SVG.extend({options:{padding:.3,useRaster:i.Browser.ie||i.Browser.gecko||i.Browser.edge,interactive:true},_initContainer:function n(){i.SVG.prototype._initContainer.call(this);this._rootInvertGroup=i.SVG.create("g");this._container.appendChild(this._rootInvertGroup);this._rootInvertGroup.appendChild(this._rootGroup);if(i.Browser.gecko){this._container.setAttribute("pointer-events","visiblePainted")}i.DomUtil.addClass(this._container,"schematics-renderer")},_initPath:function r(t){t.options.noClip=true;i.SVG.prototype._initPath.call(this,t)},_update:function o(){i.SVG.prototype._update.call(this);var t=this.options.schematic;var e=this._map;if(e&&t._bounds&&this._rootInvertGroup){var n=e.latLngToLayerPoint(t._bounds.getNorthWest());var r=t._ratio*e.options.crs.scale(e.getZoom()-t.options.zoomOffset);this._topLeft=n;this._scale=r;this._rootGroup.setAttribute("transform",i.DomUtil.getMatrixString(n,r));this._rootInvertGroup.setAttribute("transform",i.DomUtil.getMatrixString(n.multiplyBy(-1/r),1/r))}},exportSVG:function s(t){var e=this.options.schematic;var n=this._container.cloneNode(true);var r=i.SVG.create("clipPath");var o=i.SVG.create("rect");var s=n.lastChild;var a=n.querySelector(".svg-overlay");var h=a.querySelector("defs");o.setAttribute("x",e._bbox[0]);o.setAttribute("y",e._bbox[1]);o.setAttribute("width",e._bbox[2]);o.setAttribute("height",e._bbox[3]);r.appendChild(o);var l="viewboxClip-"+i.Util.stamp(e._group);r.setAttribute("id",l);if(!h||t){h=i.SVG.create("defs");n.appendChild(h)}h.appendChild(r);s.setAttribute("clip-path","url(#"+l+")");s.firstChild.setAttribute("transform",i.DomUtil.getMatrixString(this._topLeft.multiplyBy(-1/this._scale).add(e._viewBoxOffset),1/this._scale));s.removeAttribute("transform");n.querySelector(".svg-overlay").removeAttribute("transform");i.DomUtil.addClass(s,"clip-group");n.style.transform="";n.setAttribute("viewBox",e._bbox.join(" "));if(t){a.parentNode.removeChild(a)}var u=i.DomUtil.create("div","");u.innerHTML=/(\<svg\s+([^>]*)\>)/gi.exec(e._rawData)[0]+"</svg>";i.SVG.copySVGContents(n,u.firstChild);return u.firstChild}});i.schematicRenderer=e.exports.schematicRenderer=function(t){return new i.SchematicRenderer(t)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],5:[function(t,e,i){(function(i){"use strict";var n=typeof window!=="undefined"?window["L"]:typeof i!=="undefined"?i["L"]:null;var r=t("Base64");var o=t("./renderer");t("./bounds");t("./utils");/**
 * Schematic layer to work with SVG schematics or blueprints in Leaflet
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 * @class Schematic
 * @extends {L.Rectangle}
 */
n.Schematic=e.exports=n.Rectangle.extend({options:{opacity:0,fillOpacity:0,weight:1,adjustToScreen:true,zoomOffset:0,interactive:false,useRaster:n.Browser.ie||n.Browser.gecko||n.Browser.edge},initialize:function s(t,e,i){this._svg=t;this._initialWidth="";this._initialHeight="";if(!(e instanceof n.LatLngBounds)){i=e;e=null}i.renderer=new o({schematic:this});this._bounds=e;this._ratio=1;this._size=null;this._origin=null;this._transformation=null;this._base64encoded="";this._rawData="";this._viewBoxOffset=n.point(0,0);this._ready=false;if(typeof t==="string"&&!/\<svg/gi.test(t)){this._svg=null;this._url=t;if(!i.load){throw new Error("SVGOverlay requires external request implementation. "+"You have to provide `load` function with the options")}}this._group=null;this._canvasRenderer=null;this._raster=null;this._rasterShown=false;n.Rectangle.prototype.initialize.call(this,n.latLngBounds([0,0],[0,0]),i)},onAdd:function a(t){n.Rectangle.prototype.onAdd.call(this,t);this._ready=false;if(!this._group){this._group=n.SVG.create("g");n.Util.stamp(this._group);n.DomUtil.addClass(this._group,"svg-overlay")}if(!this._svg){this.load()}else{this.onLoad(this._svg)}if(n.Browser.gecko){this._path.setAttribute("pointer-events","none")}if(this.options.useRaster){var e=new n.Canvas({}).addTo(t);e._container.parentNode.insertBefore(e._container,this._renderer._container);this._canvasRenderer=e;t.dragging._draggable.on("predrag",this._onPreDrag,this).on("dragend",this._onDragEnd,this);e._container.style.display="none"}},onRemove:function h(t){if(null!==this._group.parentNode){this._group.parentNode.removeChild(this._group)}n.Rectangle.prototype.onRemove.call(this,t);if(this._canvasRenderer){this._canvasRenderer.removeFrom(t);t.dragging._draggable.off("predrag",this._onPreDrag,this).off("dragend",this._onDragEnd,this)}this._renderer.removeFrom(t)},load:function l(){this.options.load(this._url,n.Util.bind(function(t,e){if(t){this.onError(t)}else{this.onLoad(e)}},this))},_readSVGData:function u(t){var e=new DOMParser;var i=new XMLSerializer;var r=e.parseFromString(t,"application/xml");var o=r.documentElement;if(o.querySelector("parsererror")!==null){return this.onError(new Error("SVG parse error"))}this._initialWidth=o.getAttribute("width");this._initialHeight=o.getAttribute("height");this._bbox=n.DomUtil.getSVGBBox(o);var s=this._bbox[2]-this._bbox[0];var a=this._bbox[3]-this._bbox[1];if(this._initialWidth!==null&&parseFloat(this._initialWidth)!==s||this._initialHeight!==null&&parseFloat(this._initialHeight)!==a){o.setAttribute("width",s);o.setAttribute("height",a)}this._rawData=t;this._processedData=i.serializeToString(r);if(o.getAttribute("viewBox")===null){o.setAttribute("viewBox",this._bbox.join(" "));this._processedData=this._processedData.replace("<svg",'<svg viewBox="'+this._bbox.join(" ")+'"')}return o},onError:function d(t){if(this.options.onError){this.options.onError.call(this,{error:t})}return this.fire("error",{error:t})},onLoad:function f(t){if(!this._map){return}t=this._readSVGData(t);var e=this._bbox;var i=this.getOriginalSize();var r=this._map.getSize();if(this.options.adjustToScreen&&i.y!==r.y){this._ratio=Math.min(r.x/i.x,r.y/i.y);this.options._zoomOffset=this._ratio<1?this._ratio:1-this._ratio;this.options.zoomOffset=0;if(this._ratio===0){this._ratio=1}}var o=this._map.getMinZoom()-this.options.zoomOffset;this._bounds=new n.LatLngBounds(this._map.unproject([e[0],e[3]],o),this._map.unproject([e[2],e[1]],o)).scale(this._ratio);this._size=i;this._origin=this._map.project(this._bounds.getCenter(),o);this._transformation=new n.Transformation(1,this._origin.x,1,this._origin.y);this._viewBoxOffset=n.point(this._bbox[0],this._bbox[1]);this._createContents(t);this._renderer._container.insertBefore(this._group,this._renderer._container.firstChild);this.fire("load");this._ready=true;this._latlngs=this._boundsToLatLngs(this._bounds);this._reset();if(this.options.useRaster){n.Util.requestAnimFrame(this.toImage,this)}},whenReady:function c(t,e){if(this._ready){t.call(e)}else{this.once("load",t,e)}return this},getDocument:function p(){return this._group},getRenderer:function _(){return this._renderer},_createContents:function g(t){n.SVG.copySVGContents(t,this._group)},getOriginalSize:function m(){var t=this._bbox;return new n.Point(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3]))},_updatePath:function v(){n.Rectangle.prototype._updatePath.call(this);if(this._group){var t=this._map.latLngToLayerPoint(this._bounds.getNorthWest());var e=this._map.options.crs.scale(this._map.getZoom()-this.options.zoomOffset)*this._ratio;this._group.setAttribute("transform",n.DomUtil.getMatrixString(t.subtract(this._viewBoxOffset.multiplyBy(e)),e));if(this._canvasRenderer){this._redrawCanvas(t,e)}}},_unscalePoint:function y(t){return this._transformation.transform(this._transformation.untransform(t).divideBy(this._ratio))},_scalePoint:function b(t){return this._transformation.transform(this._transformation.untransform(t).multiplyBy(this._ratio))},getRatio:function w(){return this._ratio},projectPoint:function x(t){var e=this._map;return this._unscalePoint(e.project(t,e.getMinZoom()+this.options.zoomOffset))},unprojectPoint:function S(t){var e=this._map;return e.unproject(this._scalePoint(t),e.getMinZoom()+this.options.zoomOffset)},unprojectBounds:function B(t){var e=this.unprojectPoint(t.min);var i=this.unprojectPoint(t.max);return n.latLngBounds(e,i)},projectBounds:function C(t){return new n.Bounds(this.projectPoint(t.getSouthWest()),this.projectPoint(t.getNorthEast()))},exportSVG:function L(t,e){var i=this._renderer.exportSVG(e);return t?i.outerHTML:i},toImage:function R(){var t=new Image;t.style.width=this._size.x+"px";t.style.height=this._size.y+"px";t.src=this.toBase64();n.DomEvent.on(t,"load",function(){n.point(t.offsetWidth,t.offsetHeight);this._reset()},this);t.style.opacity=0;t.style.zIndex=-9999;t.style.pointerEvents="none";if(this._raster){this._raster.parentNode.removeChild(this._raster);this._raster=null}n.DomUtil.addClass(t,"schematic-image");this._renderer._container.parentNode.insertBefore(t,this._renderer._container);this._raster=t;return this},toBase64:function A(){var t=this._base64encoded||r.btoa(unescape(encodeURIComponent(this._processedData)));this._base64encoded=t;return"data:image/svg+xml;base64,"+t},_redrawCanvas:function D(t,e){if(!this._raster){return}var i=this.getOriginalSize().multiplyBy(e);var r=this._canvasRenderer._ctx;n.Util.requestAnimFrame(function(){r.drawImage(this._raster,t.x,t.y,i.x,i.y)},this)},_showRaster:function G(){if(this._canvasRenderer&&!this._rasterShown){this._canvasRenderer._container.style.display="block";this._group.style.display="none";this._rasterShown=true}},_hideRaster:function j(){if(this._canvasRenderer&&this._rasterShown){this._canvasRenderer._container.style.display="none";this._group.style.display="block";this._rasterShown=false}},_onPreDrag:function V(){if(this.options.useRaster){this._showRaster()}},_onDragEnd:function P(){if(this.options.useRaster){this._hideRaster()}}});n.Schematic.prototype.project=n.Schematic.prototype.projectPoint;n.Schematic.prototype.unproject=n.Schematic.prototype.unprojectPoint;n.schematic=function(t,e,i){return new n.Schematic(t,e,i)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./bounds":3,"./renderer":4,"./utils":6,Base64:2}],6:[function(t,e,i){(function(t){"use strict";var e=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol?"symbol":typeof t};var i=typeof window!=="undefined"?window["L"]:typeof t!=="undefined"?t["L"]:null;i.Browser.phantomjs=navigator.userAgent.toLowerCase().indexOf("phantom");if("SVGElementInstance"in window){Object.defineProperty(SVGElementInstance.prototype,"className",{get:function r(){return this.correspondingElement.className.baseVal},set:function o(t){this.correspondingElement.className.baseVal=t}})}i.DomUtil.isNode=function(t){return(typeof Node==="undefined"?"undefined":e(Node))==="object"?t instanceof Node:t&&(typeof t==="undefined"?"undefined":e(t))==="object"&&typeof t.nodeType==="number"&&typeof t.nodeName==="string"};i.DomUtil.getSVGBBox=function(t){var e;var i=parseInt(t.getAttribute("width"),10);var r=parseInt(t.getAttribute("height"),10);var o=t.getAttribute("viewBox");var s;if(o){s=o.split(" ").map(parseFloat);e=[s[0],s[1],s[0]+s[2],s[1]+s[3]]}else if(i&&r){e=[0,0,i,r]}else{var a=t.cloneNode(true);a.style.position="absolute";a.style.top=0;a.style.left=0;a.style.zIndex=-1;a.style.opacity=0;document.body.appendChild(a);if(a.clientWidth&&a.clientHeight){e=[0,0,a.clientWidth,a.clientHeight]}else{e=n(a)}document.body.removeChild(a)}return e};function n(t){var e=[Infinity,Infinity,-Infinity,-Infinity];var i=[].slice.call(t.querySelectorAll("*"));var n=Math.min,r=Math.max;for(var o=0,s=i.length;o<s;o++){var a=i[o];if(a.getBBox){a=a.getBBox();e[0]=n(a.x,e[0]);e[1]=n(a.y,e[1]);e[2]=r(a.x+a.width,e[2]);e[3]=r(a.y+a.height,e[3])}}return e}i.DomUtil.getSVGContainer=function(t){var e=document.createElement("div");e.innerHTML=t;return e.querySelector("svg")};i.DomUtil.getMatrixString=function(t,e){return"matrix("+[e,0,0,e,t.x,t.y].join(",")+")"};i.SVG.copySVGContents=function(t,e){if(i.Browser.ie||i.Browser.phantomjs){var n=t.firstChild;do{e.appendChild(n);n=t.firstChild}while(n)}else{e.innerHTML=t.innerHTML}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[1])(1)});