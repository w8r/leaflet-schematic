(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}(e.L||(e.L={})).Schematic=t()}})(function(){var t,e,i;return function r(t,e,i){function n(s,a){if(!e[s]){if(!t[s]){var h=typeof require=="function"&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=e[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return n(i?i:e)},c,c.exports,r,t,e,i)}return e[s].exports}var o=typeof require=="function"&&require;for(var s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e,i){"use strict";e.exports=t("./src/schematic")},{"./src/schematic":5}],2:[function(t,e,i){(function(){var t=typeof i!="undefined"?i:this;var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(t){this.message=t}r.prototype=new Error;r.prototype.name="InvalidCharacterError";t.btoa||(t.btoa=function(t){var i=String(t);for(var n,o,s=0,a=e,h="";i.charAt(s|0)||(a="=",s%1);h+=a.charAt(63&n>>8-s%1*8)){o=i.charCodeAt(s+=3/4);if(o>255){throw new r("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.")}n=n<<8|o}return h});t.atob||(t.atob=function(t){var i=String(t).replace(/=+$/,"");if(i.length%4==1){throw new r("'atob' failed: The string to be decoded is not correctly encoded.")}for(var n=0,o,s,a=0,h="";s=i.charAt(a++);~s&&(o=n%4?o*64+s:s,n++%4)?h+=String.fromCharCode(255&o>>(-2*n&6)):0){s=e.indexOf(s)}return h})})()},{}],3:[function(t,e,i){"use strict";var r=t("leaflet");r.Bounds.prototype.toBBox=function(){return[this.min.x,this.min.y,this.max.x,this.max.y]};r.Bounds.prototype.scale=function(t){var e=this.max;var i=this.min;var n=(e.x-i.x)/2*(t-1);var o=(e.y-i.y)/2*(t-1);return new r.Bounds([[i.x-n,i.y-o],[e.x+n,e.y+o]])};r.LatLngBounds.prototype.toBBox=function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()]};r.LatLngBounds.prototype.scale=function(t){var e=this._northEast;var i=this._southWest;var n=(e.lng-i.lng)/2*(t-1);var o=(e.lat-i.lat)/2*(t-1);return new r.LatLngBounds([[i.lat-o,i.lng-n],[e.lat+o,e.lng+n]])}},{leaflet:undefined}],4:[function(t,e,i){"use strict";var r=t("leaflet");r.SchematicRenderer=e.exports=r.SVG.extend({options:{padding:.3,useRaster:r.Browser.ie||r.Browser.gecko||r.Browser.edge,interactive:true},_initContainer:function n(){r.SVG.prototype._initContainer.call(this);this._rootInvertGroup=r.SVG.create("g");this._container.appendChild(this._rootInvertGroup);this._rootInvertGroup.appendChild(this._rootGroup);if(r.Browser.gecko){this._container.setAttribute("pointer-events","visiblePainted")}r.DomUtil.addClass(this._container,"schematics-renderer")},_initPath:function o(t){t.options.noClip=true;r.SVG.prototype._initPath.call(this,t)},_update:function s(){r.SVG.prototype._update.call(this);var t=this.options.schematic;var e=this._map;if(e&&t._bounds&&this._rootInvertGroup){var i=e.latLngToLayerPoint(t._bounds.getNorthWest());var n=t._ratio*e.options.crs.scale(e.getZoom()-t.options.zoomOffset);this._topLeft=i;this._scale=n;this._rootGroup.setAttribute("transform",r.DomUtil.getMatrixString(i,n));this._rootInvertGroup.setAttribute("transform",r.DomUtil.getMatrixString(i.multiplyBy(-1/n),1/n))}},exportSVG:function a(t){var e=this.options.schematic;var i=this._container.cloneNode(true);var n=r.SVG.create("clipPath");var o=r.SVG.create("rect");var s=i.lastChild;var a=i.querySelector(".svg-overlay");var h=a.querySelector("defs");o.setAttribute("x",e._bbox[0]);o.setAttribute("y",e._bbox[1]);o.setAttribute("width",e._bbox[2]);o.setAttribute("height",e._bbox[3]);n.appendChild(o);var u="viewboxClip-"+r.Util.stamp(e._group);n.setAttribute("id",u);if(!h||t){h=r.SVG.create("defs");i.appendChild(h)}h.appendChild(n);s.setAttribute("clip-path","url(#"+u+")");s.firstChild.setAttribute("transform",r.DomUtil.getMatrixString(this._topLeft.multiplyBy(-1/this._scale).add(e._viewBoxOffset),1/this._scale));s.removeAttribute("transform");i.querySelector(".svg-overlay").removeAttribute("transform");r.DomUtil.addClass(s,"clip-group");i.style.transform="";i.setAttribute("viewBox",e._bbox.join(" "));if(t){a.parentNode.removeChild(a)}var c=r.DomUtil.create("div","");c.innerHTML=/(\<svg\s+([^>]*)\>)/gi.exec(e._rawData)[0]+"</svg>";r.SVG.copySVGContents(i,c.firstChild);return c.firstChild}});r.schematicRenderer=e.exports.schematicRenderer=function(t){return new r.SchematicRenderer(t)}},{leaflet:undefined}],5:[function(t,e,i){"use strict";var r=t("leaflet");var n=t("Base64");var o=t("./renderer");t("./bounds");t("./utils");/**
 * Schematic layer to work with SVG schematics or blueprints in Leaflet
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 * @class Schematic
 * @extends {L.Rectangle}
 */
r.Schematic=e.exports=r.Rectangle.extend({options:{opacity:0,fillOpacity:0,weight:1,adjustToScreen:true,zoomOffset:0,interactive:false,useRaster:r.Browser.ie||r.Browser.gecko||r.Browser.edge},initialize:function s(t,e,i){this._svg=t;this._initialWidth="";this._initialHeight="";if(!(e instanceof r.LatLngBounds)){i=e;e=null}i.renderer=new o({schematic:this});this._bounds=e;this._ratio=1;this._size=null;this._origin=null;this._transformation=null;this._base64encoded="";this._rawData="";this._viewBoxOffset=r.point(0,0);this._ready=false;if(typeof t==="string"&&!/\<svg/gi.test(t)){this._svg=null;this._url=t;if(!i.load){throw new Error("SVGOverlay requires external request implementation. "+"You have to provide `load` function with the options")}}this._group=null;this._canvasRenderer=null;this._raster=null;this._rasterShown=false;r.Rectangle.prototype.initialize.call(this,r.latLngBounds([0,0],[0,0]),i)},onAdd:function a(t){r.Rectangle.prototype.onAdd.call(this,t);this._ready=false;if(!this._group){this._group=r.SVG.create("g");r.Util.stamp(this._group);r.DomUtil.addClass(this._group,"svg-overlay")}if(!this._svg){this.load()}else{this.onLoad(this._svg)}if(r.Browser.gecko){this._path.setAttribute("pointer-events","none")}if(this.options.useRaster){var e=new r.Canvas({}).addTo(t);e._container.parentNode.insertBefore(e._container,this._renderer._container);this._canvasRenderer=e;t.dragging._draggable.on("predrag",this._onPreDrag,this).on("dragend",this._onDragEnd,this);e._container.style.visibility="hidden"}},onRemove:function h(t){this._group.parentNode.removeChild(this._group);r.Rectangle.prototype.onRemove.call(this,t);if(this._canvasRenderer){this._canvasRenderer.removeFrom(t);t.dragging._draggable.off("predrag",this._onPreDrag,this).off("dragend",this._onDragEnd,this)}this._renderer.removeFrom(t)},load:function u(){this.options.load(this._url,function(t,e){if(!t){this.onLoad(e)}}.bind(this))},_readSVGData:function c(t){var e=new DOMParser;var i=new XMLSerializer;var n=e.parseFromString(t,"application/xml");var o=n.documentElement;this._initialWidth=o.getAttribute("width");this._initialHeight=o.getAttribute("height");this._bbox=r.DomUtil.getSVGBBox(o);var s=this._bbox[2]-this._bbox[0];var a=this._bbox[3]-this._bbox[1];if(parseFloat(this._initialWidth)!==s||parseFloat(this._initialHeight)!==a){o.setAttribute("width",s);o.setAttribute("height",a)}this._rawData=t;this._processedData=i.serializeToString(n);if(o.getAttribute("viewBox")===null){o.setAttribute("viewBox",this._bbox.join(" "));this._processedData=this._processedData.replace("<svg",'<svg viewBox="'+this._bbox.join(" ")+'"')}return o},onLoad:function l(t){if(!this._map){return}t=this._readSVGData(t);var e=this._bbox;var i=this.getOriginalSize();var n=this._map.getSize();if(this.options.adjustToScreen&&i.y!==n.y){this._ratio=Math.min(n.x/i.x,n.y/i.y);this.options._zoomOffset=this._ratio<1?this._ratio:1-this._ratio;this.options.zoomOffset=0}var o=this._map.getMinZoom()-this.options.zoomOffset;this._bounds=new r.LatLngBounds(this._map.unproject([e[0],e[3]],o),this._map.unproject([e[2],e[1]],o)).scale(this._ratio);this._size=i;this._origin=this._map.project(this._bounds.getCenter(),o);this._transformation=new r.Transformation(1,this._origin.x,1,this._origin.y);this._viewBoxOffset=r.point(this._bbox[0],this._bbox[1]);this._createContents(t);this._renderer._container.insertBefore(this._group,this._renderer._container.firstChild);this.fire("load");this._ready=true;this._latlngs=this._boundsToLatLngs(this._bounds);this._reset();if(this.options.useRaster){this.toImage()}},whenReady:function d(t,e){if(this._ready){t.call(e)}else{this.once("load",t,e)}return this},getDocument:function f(){return this._group},getRenderer:function p(){return this._renderer},_createContents:function _(t){r.SVG.copySVGContents(t,this._group)},getOriginalSize:function g(){var t=this._bbox;return new r.Point(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3]))},_updatePath:function m(){r.Rectangle.prototype._updatePath.call(this);if(this._group){var t=this._map.latLngToLayerPoint(this._bounds.getNorthWest());var e=this._map.options.crs.scale(this._map.getZoom()-this.options.zoomOffset)*this._ratio;this._group.setAttribute("transform",r.DomUtil.getMatrixString(t.subtract(this._viewBoxOffset.multiplyBy(e)),e));if(this._canvasRenderer){this._redrawCanvas(t,e)}}},_unscalePoint:function v(t){return this._transformation.transform(this._transformation.untransform(t).divideBy(this._ratio))},_scalePoint:function y(t){return this._transformation.transform(this._transformation.untransform(t).multiplyBy(this._ratio))},getRatio:function b(){return this._ratio},projectPoint:function x(t){var e=this._map;return this._unscalePoint(e.project(t,e.getMinZoom()+this.options.zoomOffset))},unprojectPoint:function w(t){var e=this._map;return e.unproject(this._scalePoint(t),e.getMinZoom()+this.options.zoomOffset)},unprojectBounds:function S(t){var e=this.unprojectPoint(t.min);var i=this.unprojectPoint(t.max);return r.latLngBounds(e,i)},projectBounds:function B(t){return new r.Bounds(this.projectPoint(t.getSouthWest()),this.projectPoint(t.getNorthEast()))},exportSVG:function C(t,e){var i=this._renderer.exportSVG(e);return t?i.outerHTML:i},toImage:function R(){var t=new Image;t.style.width=this._size.x+"px";t.style.height=this._size.y+"px";t.src=this.toBase64();r.DomEvent.on(t,"load",function(){r.point(t.offsetWidth,t.offsetHeight);this._reset()},this);t.style.opacity=0;t.style.zIndex=-9999;t.style.pointerEvents="none";if(this._raster){this._raster.parentNode.removeChild(this._raster);this._raster=null}r.DomUtil.addClass(t,"schematic-image");this._renderer._container.parentNode.insertBefore(t,this._renderer._container);this._raster=t;return this},toBase64:function D(){var t=this._base64encoded||n.btoa(unescape(encodeURIComponent(this._processedData)));this._base64encoded=t;return"data:image/svg+xml;base64,"+t},_redrawCanvas:function L(t,e){if(!this._raster){return}var i=this.getOriginalSize().multiplyBy(e);var n=this._canvasRenderer._ctx;r.Util.requestAnimFrame(function(){n.drawImage(this._raster,t.x,t.y,i.x,i.y)},this)},_showRaster:function G(){if(this._canvasRenderer&&!this._rasterShown){this._canvasRenderer._container.style.visibility="visible";this._group.style.display="none";this._rasterShown=true}},_hideRaster:function A(){if(this._canvasRenderer&&this._rasterShown){this._canvasRenderer._container.style.visibility="hidden";this._group.style.display="block";this._rasterShown=false}},_onPreDrag:function j(){if(this.options.useRaster){this._showRaster()}},_onDragEnd:function V(){if(this.options.useRaster){this._hideRaster()}}});r.Schematic.prototype.project=r.Schematic.prototype.projectPoint;r.Schematic.prototype.unproject=r.Schematic.prototype.unprojectPoint;r.schematic=function(t,e,i){return new r.Schematic(t,e,i)}},{"./bounds":3,"./renderer":4,"./utils":6,Base64:2,leaflet:undefined}],6:[function(t,e,i){"use strict";var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol?"symbol":typeof t};var n=t("leaflet");n.Browser.phantomjs=navigator.userAgent.toLowerCase().indexOf("phantom");if("SVGElementInstance"in window){Object.defineProperty(SVGElementInstance.prototype,"className",{get:function s(){return this.correspondingElement.className.baseVal},set:function a(t){this.correspondingElement.className.baseVal=t}})}n.DomUtil.isNode=function(t){return(typeof Node==="undefined"?"undefined":r(Node))==="object"?t instanceof Node:t&&(typeof t==="undefined"?"undefined":r(t))==="object"&&typeof t.nodeType==="number"&&typeof t.nodeName==="string"};n.DomUtil.getSVGBBox=function(t){var e=t.getAttribute("viewBox");var i;if(e){i=e.split(" ").map(parseFloat)}else{var r=t.cloneNode(true);document.body.appendChild(r);i=o(r);document.body.removeChild(r);return i}return[i[0],i[1],i[0]+i[2],i[1]+i[3]]};function o(t){var e=[Infinity,Infinity,-Infinity,-Infinity];var i=[].slice.call(t.querySelectorAll("*"));var r=Math.min,n=Math.max;for(var o=0,s=i.length;o<s;o++){var a=i[o];if(a.getBBox){a=a.getBBox();e[0]=r(a.x,e[0]);e[1]=r(a.y,e[1]);e[2]=n(a.x+a.width,e[2]);e[3]=n(a.y+a.height,e[3])}}return e}n.DomUtil.getSVGContainer=function(t){var e=document.createElement("div");e.innerHTML=t;return e.querySelector("svg")};n.DomUtil.getMatrixString=function(t,e){return"matrix("+[e,0,0,e,t.x,t.y].join(",")+")"};n.SVG.copySVGContents=function(t,e){if(n.Browser.ie||n.Browser.phantomjs){var i=t.firstChild;do{e.appendChild(i);i=t.firstChild}while(i)}else{e.innerHTML=t.innerHTML}}},{leaflet:undefined}]},{},[1])(1)});