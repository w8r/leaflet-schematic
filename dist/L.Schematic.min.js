(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}(e.L||(e.L={})).Schematic=t()}})(function(){var o,t,e;return function(){function u(o,s,a){function h(i,t){if(!s[i]){if(!o[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(l)return l(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var r=s[i]={exports:{}};o[i][0].call(r.exports,function(t){var e=o[i][1][t];return h(e||t)},r,r.exports,u,o,s,a)}return s[i].exports}for(var l="function"==typeof require&&require,t=0;t<a.length;t++)h(a[t]);return h}return u}()({1:[function(t,e,i){"use strict";e.exports=t("./src/schematic")},{"./src/schematic":5}],2:[function(t,n,r){(function(t){"use strict";if(typeof r==="object"&&r!=null&&typeof r.nodeType!=="number"){n.exports=t()}else if(typeof o==="function"&&o.amd!=null){o([],t)}else{var e=t();var i=typeof self!=="undefined"?self:$.global;if(typeof i.btoa!=="function")i.btoa=e.btoa;if(typeof i.atob!=="function")i.atob=e.atob}})(function(){"use strict";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function h(t){this.message=t}h.prototype=new Error;h.prototype.name="InvalidCharacterError";function t(t){var e=String(t);for(var i,n,r=0,o=a,s="";e.charAt(r|0)||(o="=",r%1);s+=o.charAt(63&i>>8-r%1*8)){n=e.charCodeAt(r+=3/4);if(n>255){throw new h("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.")}i=i<<8|n}return s}function e(t){var e=String(t).replace(/[=]+$/,"");if(e.length%4===1){throw new h("'atob' failed: The string to be decoded is not correctly encoded.")}for(var i=0,n,r,o=0,s="";r=e.charAt(o++);~r&&(n=i%4?n*64+r:r,i++%4)?s+=String.fromCharCode(255&n>>(-2*i&6)):0){r=a.indexOf(r)}return s}return{btoa:t,atob:e}})},{}],3:[function(t,e,i){(function(t){"use strict";var o=typeof window!=="undefined"?window["L"]:typeof t!=="undefined"?t["L"]:null;o.Bounds.prototype.toBBox=function(){return[this.min.x,this.min.y,this.max.x,this.max.y]};o.Bounds.prototype.scale=function(t){var e=this.max,i=this.min;var n=(e.x-i.x)/2*(t-1);var r=(e.y-i.y)/2*(t-1);return new o.Bounds([[i.x-n,i.y-r],[e.x+n,e.y+r]])};o.LatLngBounds.prototype.toBBox=function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()]};o.LatLngBounds.prototype.scale=function(t){var e=this._northEast;var i=this._southWest;var n=(e.lng-i.lng)/2*(t-1);var r=(e.lat-i.lat)/2*(t-1);return new o.LatLngBounds([[i.lat-r,i.lng-n],[e.lat+r,e.lng+n]])}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],4:[function(t,e,i){(function(t){"use strict";var d=typeof window!=="undefined"?window["L"]:typeof t!=="undefined"?t["L"]:null;d.SchematicRenderer=e.exports=d.SVG.extend({options:{padding:.3,useRaster:d.Browser.ie||d.Browser.gecko||d.Browser.edge,interactive:true},_initContainer:function t(){d.SVG.prototype._initContainer.call(this);this._rootInvertGroup=d.SVG.create("g");this._container.appendChild(this._rootInvertGroup);this._rootInvertGroup.appendChild(this._rootGroup);if(d.Browser.gecko){this._container.setAttribute("pointer-events","visiblePainted")}d.DomUtil.addClass(this._container,"schematics-renderer")},_initPath:function t(e){e.options.noClip=true;d.SVG.prototype._initPath.call(this,e)},_update:function t(){d.SVG.prototype._update.call(this);var e=this.options.schematic;var i=this._map;if(i&&e._bounds&&this._rootInvertGroup){var n=i.latLngToLayerPoint(e._bounds.getNorthWest());var r=e._ratio*i.options.crs.scale(i.getZoom()-e.options.zoomOffset);this._topLeft=n;this._scale=r;this._rootGroup.setAttribute("transform",d.DomUtil.getMatrixString(n,r));this._rootInvertGroup.setAttribute("transform",d.DomUtil.getMatrixString(n.multiplyBy(-1/r),1/r))}},exportSVG:function t(e){var i=this.options.schematic;var n=this._container.cloneNode(true);var r=d.SVG.create("clipPath");var o=d.SVG.create("rect");var s=n.lastChild;var a=n.querySelector(".svg-overlay");var h=a.querySelector("defs");o.setAttribute("x",i._bbox[0]);o.setAttribute("y",i._bbox[1]);o.setAttribute("width",i._bbox[2]);o.setAttribute("height",i._bbox[3]);r.appendChild(o);var l="viewboxClip-"+d.Util.stamp(i._group);r.setAttribute("id",l);if(!h||e){h=d.SVG.create("defs");n.appendChild(h)}h.appendChild(r);s.setAttribute("clip-path","url(#"+l+")");s.firstChild.setAttribute("transform",d.DomUtil.getMatrixString(this._topLeft.multiplyBy(-1/this._scale).add(i._viewBoxOffset),1/this._scale));s.removeAttribute("transform");n.querySelector(".svg-overlay").removeAttribute("transform");d.DomUtil.addClass(s,"clip-group");n.style.transform="";n.setAttribute("viewBox",i._bbox.join(" "));if(e){a.parentNode.removeChild(a)}var u=d.DomUtil.create("div","");u.innerHTML=/(\<svg\s+([^>]*)\>)/gi.exec(i._rawData)[0]+"</svg>";d.SVG.copySVGContents(n,u.firstChild);return u.firstChild}});d.schematicRenderer=e.exports.schematicRenderer=function(t){return new d.SchematicRenderer(t)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],5:[function(e,n,t){(function(t){"use strict";var h=typeof window!=="undefined"?window["L"]:typeof t!=="undefined"?t["L"]:null;var i=e("Base64");var r=e("./renderer");e("./bounds");e("./utils");
/**
 * Schematic layer to work with SVG schematics or blueprints in Leaflet
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 * @class Schematic
 * @extends {L.Rectangle}
 */h.Schematic=n.exports=h.Rectangle.extend({options:{opacity:0,fillOpacity:0,weight:1,adjustToScreen:true,zoomOffset:0,interactive:false,useRaster:h.Browser.ie||h.Browser.gecko||h.Browser.edge},initialize:function t(e,i,n){this._svg=e;this._initialWidth="";this._initialHeight="";if(!(i instanceof h.LatLngBounds)){n=i;i=null}n.renderer=new r({schematic:this});this._bounds=i;this._ratio=1;this._size=null;this._origin=null;this._transformation=null;this._base64encoded="";this._rawData="";this._viewBoxOffset=h.point(0,0);this._ready=false;if(typeof e==="string"&&!/\<svg/gi.test(e)){this._svg=null;this._url=e;if(!n.load){throw new Error("SVGOverlay requires external request implementation. "+"You have to provide `load` function with the options")}}this._group=null;this._canvasRenderer=null;this._raster=null;this._rasterShown=false;h.Rectangle.prototype.initialize.call(this,h.latLngBounds([0,0],[0,0]),n)},onAdd:function t(e){h.Rectangle.prototype.onAdd.call(this,e);this._ready=false;if(!this._group){this._group=h.SVG.create("g");h.Util.stamp(this._group);h.DomUtil.addClass(this._group,"svg-overlay")}if(!this._svg){this.load()}else{this.onLoad(this._svg)}if(h.Browser.gecko){this._path.setAttribute("pointer-events","none")}if(this.options.useRaster){var i=new h.Canvas({}).addTo(e);i._container.parentNode.insertBefore(i._container,this._renderer._container);this._canvasRenderer=i;e.dragging._draggable.on("predrag",this._onPreDrag,this).on("dragend",this._onDragEnd,this);i._container.style.display="none"}},onRemove:function t(e){if(null!==this._group.parentNode){this._group.parentNode.removeChild(this._group)}h.Rectangle.prototype.onRemove.call(this,e);if(this._canvasRenderer){this._canvasRenderer.removeFrom(e);e.dragging._draggable.off("predrag",this._onPreDrag,this).off("dragend",this._onDragEnd,this)}this._renderer.removeFrom(e)},load:function t(){this.options.load(this._url,h.Util.bind(function(t,e){if(t){this.onError(t)}else{this.onLoad(e)}},this))},_readSVGData:function t(e){var i=new DOMParser;var n=new XMLSerializer;var r=i.parseFromString(e,"application/xml");var o=r.documentElement;if(o.querySelector("parsererror")!==null){return this.onError(new Error("SVG parse error"))}this._initialWidth=o.getAttribute("width");this._initialHeight=o.getAttribute("height");this._bbox=h.DomUtil.getSVGBBox(o);var s=this._bbox[2]-this._bbox[0];var a=this._bbox[3]-this._bbox[1];if(this._initialWidth!==null&&parseFloat(this._initialWidth)!==s||this._initialHeight!==null&&parseFloat(this._initialHeight)!==a){o.setAttribute("width",s);o.setAttribute("height",a)}this._rawData=e;this._processedData=n.serializeToString(r);if(o.getAttribute("viewBox")===null){o.setAttribute("viewBox",this._bbox.join(" "));this._processedData=this._processedData.replace("<svg",'<svg viewBox="'+this._bbox.join(" ")+'"')}return o},onError:function t(e){if(this.options.onError){this.options.onError.call(this,{error:e})}return this.fire("error",{error:e})},onLoad:function t(e){if(!this._map){return}e=this._readSVGData(e);var i=this._bbox;var n=this.getOriginalSize();var r=this._map.getSize();if(this.options.adjustToScreen&&n.y!==r.y){this._ratio=Math.min(r.x/n.x,r.y/n.y);this.options._zoomOffset=this._ratio<1?this._ratio:1-this._ratio;this.options.zoomOffset=0;if(this._ratio===0){this._ratio=1}}var o=this._map.getMinZoom()-this.options.zoomOffset;this._bounds=new h.LatLngBounds(this._map.unproject([i[0],i[3]],o),this._map.unproject([i[2],i[1]],o)).scale(this._ratio);this._size=n;this._origin=this._map.project(this._bounds.getCenter(),o);this._transformation=new h.Transformation(1,this._origin.x,1,this._origin.y);this._viewBoxOffset=h.point(this._bbox[0],this._bbox[1]);this._createContents(e);this._renderer._container.insertBefore(this._group,this._renderer._container.firstChild);this.fire("load");this._ready=true;this._latlngs=this._boundsToLatLngs(this._bounds);this._reset();if(this.options.useRaster){h.Util.requestAnimFrame(this.toImage,this)}},whenReady:function t(e,i){if(this._ready){e.call(i)}else{this.once("load",e,i)}return this},getDocument:function t(){return this._group},getRenderer:function t(){return this._renderer},_createContents:function t(e){h.SVG.copySVGContents(e,this._group)},getOriginalSize:function t(){var e=this._bbox;return new h.Point(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3]))},_updatePath:function t(){h.Rectangle.prototype._updatePath.call(this);if(this._group){var e=this._map.latLngToLayerPoint(this._bounds.getNorthWest());var i=this._map.options.crs.scale(this._map.getZoom()-this.options.zoomOffset)*this._ratio;this._group.setAttribute("transform",h.DomUtil.getMatrixString(e.subtract(this._viewBoxOffset.multiplyBy(i)),i));if(this._canvasRenderer){this._redrawCanvas(e,i)}}},_unscalePoint:function t(e){return this._transformation.transform(this._transformation.untransform(e).divideBy(this._ratio))},_scalePoint:function t(e){return this._transformation.transform(this._transformation.untransform(e).multiplyBy(this._ratio))},getRatio:function t(){return this._ratio},projectPoint:function t(e){var i=this._map;return this._unscalePoint(i.project(e,i.getMinZoom()+this.options.zoomOffset))},unprojectPoint:function t(e){var i=this._map;return i.unproject(this._scalePoint(e),i.getMinZoom()+this.options.zoomOffset)},unprojectBounds:function t(e){var i=this.unprojectPoint(e.min);var n=this.unprojectPoint(e.max);return h.latLngBounds(i,n)},projectBounds:function t(e){return new h.Bounds(this.projectPoint(e.getSouthWest()),this.projectPoint(e.getNorthEast()))},exportSVG:function t(e,i){var n=this._renderer.exportSVG(i);if(e){var r=h.DomUtil.create("div");r.appendChild(n);return r.innerHTML}return n},toImage:function t(){var e=this;var i=new Image;i.style.width=this._size.x+"px";i.style.height=this._size.y+"px";i.src=this.toBase64();h.DomEvent.on(i,"load",function(){h.point(i.offsetWidth,i.offsetHeight);e._reset()});i.style.opacity=0;i.style.zIndex=-9999;i.style.pointerEvents="none";if(this._raster){this._raster.parentNode.removeChild(this._raster);this._raster=null}h.DomUtil.addClass(i,"schematic-image");this._renderer._container.parentNode.insertBefore(i,this._renderer._container);this._raster=i;return this},toBase64:function t(){var e=this._base64encoded||i.btoa(unescape(encodeURIComponent(this._processedData)));this._base64encoded=e;return"data:image/svg+xml;base64,"+e},_redrawCanvas:function t(e,i){if(!this._raster){return}var n=this.getOriginalSize().multiplyBy(i);var r=this._canvasRenderer._ctx;h.Util.requestAnimFrame(function(){r.drawImage(this._raster,e.x,e.y,n.x,n.y)},this)},_showRaster:function t(){if(this._canvasRenderer&&!this._rasterShown){this._canvasRenderer._container.style.display="block";this._group.style.display="none";this._rasterShown=true}},_hideRaster:function t(){if(this._canvasRenderer&&this._rasterShown){this._canvasRenderer._container.style.display="none";this._group.style.display="block";this._rasterShown=false}},_onPreDrag:function t(){if(this.options.useRaster){this._showRaster()}},_onDragEnd:function t(){if(this.options.useRaster){this._hideRaster()}}});h.Schematic.prototype.project=h.Schematic.prototype.projectPoint;h.Schematic.prototype.unproject=h.Schematic.prototype.unprojectPoint;h.schematic=function(t,e,i){return new h.Schematic(t,e,i)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./bounds":3,"./renderer":4,"./utils":6,Base64:2}],6:[function(t,e,i){(function(t){"use strict";var e=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var n=typeof window!=="undefined"?window["L"]:typeof t!=="undefined"?t["L"]:null;n.Browser.phantomjs=navigator.userAgent.toLowerCase().indexOf("phantom");if("SVGElementInstance"in window){Object.defineProperty(SVGElementInstance.prototype,"className",{get:function t(){return this.correspondingElement.className.baseVal},set:function t(e){this.correspondingElement.className.baseVal=e}})}n.DomUtil.isNode=function(t){return(typeof Node==="undefined"?"undefined":e(Node))==="object"?t instanceof Node:t&&(typeof t==="undefined"?"undefined":e(t))==="object"&&typeof t.nodeType==="number"&&typeof t.nodeName==="string"};n.DomUtil.getSVGBBox=function(t){var e=void 0;var i=parseInt(t.getAttribute("width"),10);var n=parseInt(t.getAttribute("height"),10);var r=t.getAttribute("viewBox");var o=void 0;if(r){o=r.split(" ").map(parseFloat);e=[o[0],o[1],o[0]+o[2],o[1]+o[3]]}else if(i&&n){e=[0,0,i,n]}else{var s=t.cloneNode(true);s.style.position="absolute";s.style.top=0;s.style.left=0;s.style.zIndex=-1;s.style.opacity=0;document.body.appendChild(s);if(s.clientWidth&&s.clientHeight){e=[0,0,s.clientWidth,s.clientHeight]}else{e=a(s)}document.body.removeChild(s)}return e};function a(t){var e=[Infinity,Infinity,-Infinity,-Infinity];var i=[].slice.call(t.querySelectorAll("*"));var n=Math.max,r=n.min,o=n.max;for(var s=0,a=i.length;s<a;s++){var h=i[s];if(h.getBBox){h=h.getBBox();e[0]=r(h.x,e[0]);e[1]=r(h.y,e[1]);e[2]=o(h.x+h.width,e[2]);e[3]=o(h.y+h.height,e[3])}}return e}n.DomUtil.getSVGContainer=function(t){var e=document.createElement("div");e.innerHTML=t;return e.querySelector("svg")};n.DomUtil.getMatrixString=function(t,e){return"matrix("+[e,0,0,e,t.x,t.y].join(",")+")"};n.SVG.copySVGContents=function(t,e){if(n.Browser.ie||n.Browser.phantomjs){var i=t.firstChild;do{e.appendChild(i);i=t.firstChild}while(i)}else{e.innerHTML=t.innerHTML}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[1])(1)});